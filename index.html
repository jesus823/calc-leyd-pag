<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">

  <link rel="stylesheet" href="estilos.css">
  <link rel="icon" type="image/png"
    href="https://img.freepik.com/vector-gratis/ilustracion-colorida-calculadora-dibujos-animados_1308-174688.jpg">

  <title>Contador Diario Pagatodo</title>


</head>

<body>

  <!-- Script para bloquear letras en inputs numÃ©ricos - VERSIÃ“N MEJORADA -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const numericInputs = document.querySelectorAll('input[type="tel"]:not([id^="loteria"]), input.input1, input.input2, input.input3, input.input4, input.input5, input.input6, input.input7, input.input8, input.input9, input.input10, input.input11, input.input12, input.input13, input.input14, input.input15, input.input16, input.input17, input.input18, input.input19, input.input20, input.input21, input.input22, input.input23, input.input24, input.input25, input.input26, input.input27, input.input28, input.input29, input.input30, input.input31, input.input32, input.input33, input.input34, input.input35, input.input36, input.input37, input.input38, input.input39, input.input40, input.input41, input.input42, input.input43, input.input44, input.input45, input.input46, input.input47, input.input48, input.input49, input.input50, input.input51, input.input52, input.input53, input.input54, input.input55, input.input56, input.input57, input.input58, input.input59, input.input60');

      numericInputs.forEach(input => {
        input.addEventListener('keydown', function (e) {
          if ([8, 9, 13, 27, 46, 35, 36, 37, 38, 39, 40].includes(e.keyCode) ||
            (e.ctrlKey && [65, 67, 86, 88, 90].includes(e.keyCode)) ||
            (e.metaKey && [65, 67, 86, 88, 90].includes(e.keyCode))) {
            return;
          }

          if ((e.keyCode >= 48 && e.keyCode <= 57) ||
            (e.keyCode >= 96 && e.keyCode <= 105)) {
            return;
          }

          if (e.keyCode === 190 || e.keyCode === 188 || e.keyCode === 110) {
            return;
          }

          e.preventDefault();
        });

        input.addEventListener('paste', function (e) {
          setTimeout(() => {
            const valor = input.value;
            const numerosSolo = valor.replace(/[^\d]/g, '');
            input.value = numerosSolo;

            const event = new Event('input', { bubbles: true });
            input.dispatchEvent(event);
          }, 10);
        });

        input.addEventListener('blur', function () {
          const valor = input.value;
          const numerosSolo = valor.replace(/[^\d]/g, '');
          if (valor !== numerosSolo) {
            input.value = numerosSolo;
            const event = new Event('input', { bubbles: true });
            input.dispatchEvent(event);
          }
        });
      });
    });
  </script>

  <!-- Controles de conexiÃ³n P2P -->
  <div class="peer-controls">
    <button id="miIDBtn" class="peer-button" onclick="copiarMiID()">
      Mi ID: Cargando...
    </button>
    <button id="connectBtn" class="peer-button connect" onclick="conectarDispositivo()">
      ðŸ”— Conectar a otro dispositivo
    </button>
    <button id="disconnectBtn" class="peer-button disconnect" onclick="desconectar()"
      style="display:none; height: 50px;">
      ðŸš« Desconectar
    </button>
    <!-- NUEVO BOTÃ“N: Guardar Cambios -->
    <button id="guardarCambiosBtn" class="peer-button guardar" onclick="guardarCambiosConfirmados()"
      style="display:none; height: 60px;">
      ðŸ’¾ Guardar Cambios Confirmados
    </button>

    <div id="peerStatus" class="peer-status disconnected">
      Sin conexiÃ³n
    </div>
  </div>

  <!-- Tabla principal - Manteniendo la estructura original -->
  <table id="miTabla">
    <thead>
      <tr>
        <th style="width: 75px; background-color: yellow; border: 3px solid;color: black;">$ Total Venta </th>
        <th style="background-color: white; width: 30px;"></th>
        <th style="border: 3px solid; color: black;">Sumar a la Venta / Gastos / Nequi</th>
        <th style="width: 50px;border: 3px solid;color: black;">Valor</th>
        <th style="background-color: white; width: 30px;"></th>
        <th style="width: 70px;  border: 3px solid;color: black;">Billetes </th>
        <th style="width: 60px;border: 3px solid;color: black;">Unidades</th>
        <th style=" width: 110px; border: 3px solid;color: black;">Total</th>
        <th style="background-color: white; width: 30px;"></th>
        <th style="width: 50px;border: 3px solid;color: black;">Monedas</th>
        <th style="width: 60px;border: 3px solid;color: black;">Unidades</th>
        <th style="border: 3px solid;color: black; width: 105px;">Total</th>
        <th style="background-color: white; width: 30px;"></th>
        <th style=" border: 3px solid;"></th>
        <th style=" border: 3px solid;"></th>
        <th></th>
        <th
          style="background-color: #ccc; text-align: center; font-weight: bold; color: black; font-size: 12px; vertical-align: middle; padding: 5px;">
          <div style="display: inline-flex; align-items: center; justify-content: center; gap: 6px;">
            <img
              src="https://media.istockphoto.com/id/1408463718/es/vector/recordatorio-en-calendario-fecha-l%C3%ADmite-del-calendario-mensaje-push-de-notificaci%C3%B3n-de.jpg?s=612x612&w=0&k=20&c=MyiTsnAG5L-A139FJV9t-fvmVmhA6nDM4LUaqiEFp04="
              alt="" style="width: 35px; height: 35px; border-radius: 50%;">
            <span id="fechaHoraActual" style="font-size: 13px;"></span>
          </div>
        </th>
        <th style="width: 105px;"></th>
      </tr>
    </thead>
    <tbody>
      <!-- Fila 1 -->
      <tr>
        <td onclick="this.querySelector('input').focus()" style="border: 3px solid black; background-color: yellow;">
          <input type="tel" inputmode="numeric" class="venta" id="venta-total"
            style="background-color: yellow; font-size: 17px; font-weight: bold; width: 100px; height: 25px; box-shadow: 0 0 8px rgba(8, 2, 5, 1); border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off">
        </td>
        <td><textarea></textarea></td>
        <td style="border-top: 3px solid; border-bottom: 3px solid; border-left: 3px solid;">Nequi</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2" id="nequi1"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center; "
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight:bolder ;  border: 3px solid;">100,000</td>
        <td style="border: 3px solid; "><input id="b1" type="tel" class="cantidad"
            style="height: 25px; width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-bilteles" style="font-weight: bolder; border: 5px solid;">
        </td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder; border: 3px solid;">1000</td>
        <td style="border: 3px solid;"> <input type="tel" class="cantidad"
            style="height: 25px;width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-monedas" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td id="nequi" style=" border: 3px solid;">Nequii</td>
        <td style="width: 70px;  border: 3px solid;   "><input type="tel" class="cantidad4"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
      </tr>
      <!-- Fila 2 -->
      <tr>
        <td></td>
        <td><textarea></textarea></td>
        <td style="border-top: 3px solid; border-bottom: 3px solid; border-left: 3px solid;">Don Alfonso</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2" id="alfonso1"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid;">50,000</td>
        <td style="border: 3px solid;"><input id="b2" type="tel" class="cantidad"
            style="height: 25px; width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-bilteles" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid;">500</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad"
            style="height: 25px;width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-monedas" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td id="alfonso" style=" border: 3px solid;">Don Alfonso</td>
        <td style="width: 70px; border: 3px solid;"><input type="tel" class="cantidad4"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td style="position: relative; height: 40px; width: 60px;">
          <img src="stich.webp" alt="" style="
         position: absolute;
         top: 15px;
         left: 50%;
         transform: translateX(-50%);
         width: 150px;
         border-radius: 80px;
         pointer-events: none;
       ">
        </td>
      </tr>
      <!-- Fila 3 -->
      <tr>
        <td id="sobra" style="font-weight: bolder; border: 3px solid;color: black;"></td>
        <td><textarea></textarea></td>
        <td style="border-top: 3px solid; border-bottom: 3px solid; border-left: 3px solid;">Descuadre</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2" id="descuadre1"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid;">20,000</td>
        <td style="border: 3px solid;"><input id="b3" type="tel" class="cantidad"
            style="height: 25px; width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-bilteles" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid;">200</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad"
            style="height: 25px;width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-monedas" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid;" id="descuadre">Descuadre</td>
        <td style="width: 70px; border: 3px solid;"><input type="tel" class="cantidad4"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
      </tr>
      <!-- Fila 4 -->
      <tr>
        <td id="resul" style="font-weight: bolder; border: 3px solid;color: black;"></td>
        <td><textarea></textarea></td>
        <td style="border-top: 3px solid; border-bottom: 3px solid; border-left: 3px solid;">MÃ­o</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2" id="mio1"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid;">10,000</td>
        <td style="border: 3px solid;"><input id="b4" type="tel" class="cantidad"
            style="height: 25px; width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-bilteles" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid; ">100</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad"
            style="height: 25px;width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-monedas" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td id="mio" style="border: 3px solid;">MÃ­oo</td>
        <td style="width: 70px; border: 3px solid;"><input type="tel" class="cantidad4"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
      </tr>
      <!-- Fila 5 -->
      <tr>
        <td></td>
        <td><textarea></textarea></td>
        <td style="border: 3px solid;">Avances</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2" id="Avances1"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid;">5,000</td>
        <td style="border: 3px solid;"><input id="b5" type="tel" class="cantidad"
            style="height: 25px; width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-bilteles" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid;">50</td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad"
            style="height: 25px;width: 50px; text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-monedas" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td id="Avances" style="border: 3px solid;">Avances</td>
        <td style="width: 70px; border: 3px solid;"><input type="tel" class="cantidad4"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
      </tr>
      <!-- Fila 6 -->
      <tr>
        <td style="border-bottom: 2px solid black;" class="celda-con-boton">
          <p
            style="font-weight: bold; color: rgb(102, 141, 234); margin: 0; text-shadow: 6px 6px 8px rgb(5, 400, 210);">
            Borrar Todo
          </p>
          <img
            style="margin-top: 50px; width: 90px; margin-right: 10px; height: 80px; box-shadow: 4px 4px 10px rgb(5, 165, 210);"
            src="https://thumbs.dreamstime.com/b/borrador-feliz-de-la-historieta-53892555.jpg" alt="Borrar"
            class="img-flotante" onclick="confirmarBorrado()">
        </td>
        <td><textarea></textarea></td>
        <td style="border: 3px solid;"><textarea></textarea></td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td class="valor-fijo" style="font-weight: bolder;border: 3px solid;">2,000</td>
        <td style="border: 3px solid;"><input id="b6" type="tel" class="cantidad"
            style="height: 25px; width: 50px;text-align: center;" autocomplete="off"></td>
        <td class="resultado resultado-bilteles" style="font-weight: bolder;border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style="border: 3px solid;"><textarea></textarea></td>
        <td style="width: 70px; border: 3px solid;"><input type="tel" class="cantidad4"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px; text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
      </tr>
      <!-- Fila 7 -->
      <tr>
        <td style="border-bottom: 2px solid black;"><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style="border: 3px solid;"><textarea></textarea></td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;text-align: center;"
            oninput="formatearMiles(this)" autocomplete="off"></td>
        <td><textarea></textarea></td>
        <td colspan="2" style="font-weight: bold; font-size: 20px; background-color: rgb(7, 134, 7);border: 3px solid;">
          $ Total Bilteles</td>
        <td id="total-general-bilteles"
          style="font-weight: bold; font-size: 20px; background-color: rgb(7, 134, 7);border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td class="resultado-conteo-billetes"
          style="font-weight: bold; font-size: 19px; background-color: rgb(230, 12, 197);border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>



        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>

      </tr>

      <tr>
        <td> </td>
        <td><textarea></textarea></td>
        <td style="border: 3px solid;"><textarea></textarea></td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;text-align: center;"
            oninput="formatearMiles(this)"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
      </tr>

      <tr>
        <td>

        </td>

        <td><textarea></textarea></td>
        <td style="border: 3px solid;"><textarea></textarea></td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;text-align: center;"
            oninput="formatearMiles(this)"></td>
        <td><textarea></textarea></td>
        <td colspan="3"
          style="font-weight: bold; font-size: 20px;background-color: rgb(125, 129, 125);border: 3px solid;">Monedas
          Total</td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style="font-weight: bold; text-align: center; vertical-align: middle;">Cant. Premios</td>
        <td style="font-weight: bold; text-align: center; vertical-align: middle;">Valor Premios</td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>

      </tr>

      <tr>
        <td> <button type="button" onclick="confirmarEnvioExcel()" style=" box-shadow: 4px 4px 10px rgb(168, 58, 7);height: 50px; font-weight: bolder; border-color: rgb(255, 0, 85); font-size: 15px; color: rgb(221, 250, 3); border-radius: 25px;background: linear-gradient(
  to bottom,
  rgb(125, 92, 155) 0%,
  rgb(93, 55, 197) 45%,
  rgb(126, 101, 225) 55%,
  rgb(21, 83, 184) 100%
);

">
            Enviar a Excel
          </button></td>
        <td><textarea></textarea></td>
        <td style="border: 3px solid;"> <textarea></textarea></td>
        <td style="border: 3px solid;"><input type="tel" class="cantidad2"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;text-align: center;"
            oninput="formatearMiles(this)"></td>
        <td><textarea></textarea></td>
        <td colspan="2" style="font-weight: bold; font-size: 17px;background-color: rgb(7, 134, 7);border: 3px solid;">
          $ Total Monedas</td>
        <td id="total-general-monedas"
          style="font-weight: bold; font-size: 20px;background-color: rgb(7, 134, 7);border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input1"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input2"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r1"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td
          style="font-weight: bold; font-size: 17px;background-color: rgb(7, 134, 7); border: 3px solid;border: 3px solid;">
          $ Total Adicionales</td>
        <td class="resultado-adicionales"
          style="font-weight: bold; font-size: 20px; background-color: rgb(7, 134, 7);border: 3px solid;"></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input3"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input4"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria2"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias2" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r2"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td colspan="3"
          style="font-weight: bold; font-size: 20px;background-color: rgb(125, 129, 125);border: 3px solid;">Premios
          Total </td>
        <td><textarea></textarea></td>
        <td style="font-weight: bold; font-size: 17px;background-color: rgb(125, 129, 125);border: 3px solid;">
          # Premios</td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input5"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input6"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria3"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias3" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r3"></td>
      </tr>

      </tr>
      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td colspan="2" style="font-weight: bold; font-size: 17px; background-color: rgb(7, 134, 7);border: 3px solid;">
          $ Total Premios</td>
        <td style="background-color: rgb(7, 134, 7); border: 3px solid;">
          <div class="cantidad3"
            style="font-size: 17px; color: white; font-weight: bold; width: 100px; height: 25px; text-align: center;
           background-color: rgb(7, 134, 7); line-height: 25px; border-radius: 6px; pointer-events: none; user-select: none;">
          </div>
        </td>



        <td><textarea></textarea></td>
        <td style="background-color: rgb(7, 134, 7); border: 3px solid;">
          <div class="cantidad5"
            style="font-size: 17px; color: white; font-weight: bold; width: 100px; height: 25px; text-align: center;
           background-color: rgb(7, 134, 7); line-height: 25px; border-radius: 6px; pointer-events: none; user-select: none;">
          </div>
        </td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input7"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input8"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria4"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias4" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r4"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input9"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input10"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria5"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias5" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r5"></td>
      </tr>


      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td colspan="3"
          style="font-weight: bold; font-size: 17px; background-color: rgb(94, 94, 236);border: 3px solid;">Suma Total
          Bilteles + Monedas + Premios + Adicionales</td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input11"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input12"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria6"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias6" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r6"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td colspan="3" id="suma-total"
          style="font-weight: bold; font-size: 20px; background-color: rgb(20, 225, 211); border: 3px solid white; color: black; text-align: center;">
        </td>


        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input13"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input14"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria7"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias7" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r7"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input15"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input16"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria8"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias8" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r8"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input17"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input18"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria9"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias9" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r9"></td>
      </tr>


      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input19"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input20"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria10"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias10" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r10"></td>
      </tr>


      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input21"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input22"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria11"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias11" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r11"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input23"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input24"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria12"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias12" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r12"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input25"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input26"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria13"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias13" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r13"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input27"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input28"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria14"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias14" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r14"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input29"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input30"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria15"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias15" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r15"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input31"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input32"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria16"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias16" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r16"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input33"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input34"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria17"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias17" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r17"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input35"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input36"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria18"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias18" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r18"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input37"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input38"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria19"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias19" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r19"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input39"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input40"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria20"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias20" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r20"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input41"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input42"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria21"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias21" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r21"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input43"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input44"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria22"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias22" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r22"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input45"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input46"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria23"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias23" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r23"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input47"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input48"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria24"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias24" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r24"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input49"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input50"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria25"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias25" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r25"></td>
      </tr>


      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input51"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input52"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria26"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias26" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r26"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input53"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input54"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria27"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias27" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r27"></td>
      </tr>


      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input55"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input56"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria28"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias28" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r28"></td>
      </tr>

      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input57"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input58"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria29"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias29" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r29"></td>
      </tr>


      <tr>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td><textarea></textarea></td>
        <td style=" border: 3px solid; ">
          <input type="tel" class="input59"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style=" border: 3px solid; width: 110px; ">
          <input type="tel" class="input60"
            style=" font-size: 17px; font-weight: bold; width: 100px; height: 25px;  border-radius: 6px; text-align: center;"
            oninput="formatearMiles(this)">
        </td>
        <td style="position: relative; border-color: aliceblue; border: solid 3px;">
          <input type="text" id="loteria30"
            style="height: 27px; font-size: 17px; font-weight: bolder; width: 170px; align-items: center; text-align: center;"
            placeholder="   ---------">
          <ul id="sugerencias30" class="sugerencias" style="display: none; color: black;"></ul>
        </td>
        <td style="text-align: center; border-color: aliceblue; border: solid 3px;" class="r30"></td>
      </tr>

    </tbody>
  </table>

  <footer class="footer">
    Powered by <strong>JesÃºs SÃ¡nchez para Fresa </strong>
  </footer>

  <!-- LibrerÃ­as externas -->
  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.0/dist/peerjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    // ============================================
    // SISTEMA DE PERSISTENCIA Y SINCRONIZACIÃ“N P2P MEJORADO
    // ============================================

    // Variables globales
    let peer = null;
    let conexion = null;
    let miID = '';
    let esAnfitrion = false;
    let intentandoReconectar = false;
    let reconnectInterval = null;
    let ultimoTimestampRecibido = 0;
    let sincronizacionActiva = true;
let modoSoloLectura = false;
let esModoLecturaForzado = false;
 let primeraConexion = true;
    // ID persistente basado en localStorage - COMPLETAMENTE FIJO
    function obtenerPeerIdPersistente() {
      let peerId = localStorage.getItem('peer-id-persistente');

      // Si no existe, crear uno nuevo ÃšNICO
      if (!peerId) {
        // Generar ID Ãºnico basado en timestamp + random
        const timestamp = Date.now();
        const random = Math.random().toString(36).substr(2, 9);
        peerId = `pagato-${timestamp}-${random}`;

        // Guardar permanentemente
        localStorage.setItem('peer-id-persistente', peerId);
        console.log('ðŸ†• ID FIJO creado y guardado permanentemente:', peerId);

        // Mostrar al usuario su ID fijo
        setTimeout(() => {
          Swal.fire({
            title: 'Â¡ID Fijo Creado!',
            html: `
              <p>Tu ID personal es:</p>
              <strong style="font-size: 18px; color: #2196F3;">${peerId}</strong>
              <p style="margin-top: 10px; color: #666;">Este ID nunca cambiarÃ¡. GuÃ¡rdalo para reconectar tus dispositivos.</p>
            `,
            icon: 'info',
            confirmButtonText: 'Copiar ID',
            showCancelButton: true,
            cancelButtonText: 'Entendido'
          }).then((result) => {
            if (result.isConfirmed) {
              navigator.clipboard.writeText(peerId).then(() => {
                Swal.fire({
                  icon: 'success',
                  title: 'ID Copiado',
                  text: 'Tu ID ha sido copiado al portapapeles',
                  timer: 2000,
                  showConfirmButton: false
                });
              });
            }
          });
        }, 1000);
      } else {
        console.log('â™»ï¸ ID FIJO recuperado de localStorage:', peerId);
      }

      return peerId;
    }
// ============================================
// SISTEMA DE MODO SOLO LECTURA
// ============================================
// ============================================
// SISTEMA DE ANFITRIÃ“N FIJO
// ============================================

// CONFIGURA AQUÃ EL ID DEL DISPOSITIVO ANFITRIÃ“N FIJO
const ID_ANFITRION_FIJO = "tab"; // REEMPLAZA CON EL ID REAL DEL DISPOSITIVO ANFITRIÃ“N

// Verificar si este dispositivo es el anfitriÃ³n fijo
function esDispositivoAnfitrion() {
  const miIdActual = localStorage.getItem('peer-id-persistente');
  const esAnfitrionFijo = miIdActual === ID_ANFITRION_FIJO;
  
  console.log(`ðŸ” Verificando rol del dispositivo:`);
  console.log(`   Mi ID: ${miIdActual}`);
  console.log(`   ID AnfitriÃ³n Fijo: ${ID_ANFITRION_FIJO}`);
  console.log(`   Â¿Es AnfitriÃ³n? ${esAnfitrionFijo ? 'SÃ âœ…' : 'NO âŒ'}`);
  
  return esAnfitrionFijo;
}

// Mostrar rol del dispositivo al usuario
function mostrarRolDispositivo() {
  const rol = esDispositivoAnfitrion() ? 'ANFITRIÃ“N' : 'CLIENTE';
  const color = esDispositivoAnfitrion() ? '#4CAF50' : '#2196F3';
  
  console.log(`ðŸ“± ROL DEL DISPOSITIVO: ${rol}`);
  
  // Mostrar indicador visual en la interfaz
  const statusEl = document.getElementById('peerStatus');
  if (statusEl && !conexion) {
    statusEl.innerHTML = `Sin conexiÃ³n - <strong style="color: ${color}">${rol}</strong>`;
  }
}
// Alternar entre modo ediciÃ³n y solo lectura (BLOQUEADA PARA CLIENTES)
function alternarModoLectura() {
  // Solo permitir al anfitriÃ³n cambiar el modo
  if (!esAnfitrion) {
    Swal.fire({
      icon: 'error',
      title: 'Acceso Denegado',
      text: 'Este dispositivo estÃ¡ en modo solo lectura permanente.',
      timer: 2000
    });
    return;
  }
  
  // Esta funciÃ³n ahora no hace nada para clientes
  console.log('Modo lectura permanente activado');
}

// Aplicar modo solo lectura
function aplicarModoLectura() {
  const elementos = document.querySelectorAll(
    'input[type="tel"], input[type="text"], textarea, ' +
    'input.cantidad, input.cantidad2, input.cantidad4, ' +
    '.venta, .input1, .input2, .input3, .input4, .input5, ' +
    '.input6, .input7, .input8, .input9, .input10, ' +
    '.input11, .input12, .input13, .input14, .input15, ' +
    '.input16, .input17, .input18, .input19, .input20, ' +
    '.input21, .input22, .input23, .input24, .input25, ' +
    '.input26, .input27, .input28, .input29, .input30, ' +
    '.input31, .input32, .input33, .input34, .input35, ' +
    '.input36, .input37, .input38, .input39, .input40, ' +
    '.input41, .input42, .input43, .input44, .input45, ' +
    '.input46, .input47, .input48, .input49, .input50, ' +
    '.input51, .input52, .input53, .input54, .input55, ' +
    '.input56, .input57, .input58, .input59, .input60'
  );

  const controles = document.querySelector('.peer-controls');
  const botonesPeligrosos = document.querySelectorAll(
    'button[onclick="confirmarBorrado()"], ' +
    'button[onclick="confirmarEnvioExcel()"]'
  );

  if (modoSoloLectura) {
    // Bloquear todos los inputs
    elementos.forEach(el => {
      el.classList.add('bloqueado');
      el.setAttribute('readonly', 'true');
      el.disabled = true;
    });

    // Marcar visualmente el panel de controles
    if (controles) {
      controles.classList.add('modo-lectura-activo');
    }

    // Deshabilitar botones peligrosos
    botonesPeligrosos.forEach(btn => {
      btn.classList.add('bloqueado');
      btn.disabled = true;
    });

  } else {
    // Desbloquear todo
    elementos.forEach(el => {
      el.classList.remove('bloqueado');
      el.removeAttribute('readonly');
      el.disabled = false;
    });

    if (controles) {
      controles.classList.remove('modo-lectura-activo');
    }

    botonesPeligrosos.forEach(btn => {
      btn.classList.remove('bloqueado');
      btn.disabled = false;
    });
  }
}

// Enviar estado de modo lectura al otro dispositivo
function enviarModoLectura(forzar = false) {
  if (!conexion || !conexion.open) return;

  const mensaje = {
    tipo: 'modo_lectura',
    activar: forzar,
    timestamp: Date.now()
  };

  try {
    conexion.send(mensaje);
    console.log('ðŸ“¤ Modo lectura enviado:', mensaje);
  } catch (error) {
    console.error('Error al enviar modo lectura:', error);
  }
}

// Activar modo lectura para el cliente conectado
function activarModoLecturaCliente() {
  if (!esAnfitrion) {
    Swal.fire({
      icon: 'warning',
      title: 'Sin permisos',
      text: 'Solo el anfitriÃ³n puede controlar el modo lectura.',
      timer: 2000
    });
    return;
  }

  Swal.fire({
    title: 'Â¿Activar modo solo lectura?',
    text: 'El dispositivo conectado no podrÃ¡ editar datos.',
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: 'SÃ­, activar',
    cancelButtonText: 'Cancelar',
    confirmButtonColor: '#f44336'
  }).then((result) => {
    if (result.isConfirmed) {
      enviarModoLectura(true);
      
      Swal.fire({
        icon: 'success',
        title: 'Modo Activado',
        text: 'El otro dispositivo ahora estÃ¡ en modo solo lectura.',
        timer: 2000,
        showConfirmButton: false
      });
    }
  });
}

// Aplicar modo solo lectura
function aplicarModoLectura() {
  const elementos = document.querySelectorAll(
    'input[type="tel"], input[type="text"], textarea, ' +
    'input.cantidad, input.cantidad2, input.cantidad4, ' +
    '.venta, .input1, .input2, .input3, .input4, .input5, ' +
    '.input6, .input7, .input8, .input9, .input10, ' +
    '.input11, .input12, .input13, .input14, .input15, ' +
    '.input16, .input17, .input18, .input19, .input20, ' +
    '.input21, .input22, .input23, .input24, .input25, ' +
    '.input26, .input27, .input28, .input29, .input30, ' +
    '.input31, .input32, .input33, .input34, .input35, ' +
    '.input36, .input37, .input38, .input39, .input40, ' +
    '.input41, .input42, .input43, .input44, .input45, ' +
    '.input46, .input47, .input48, .input49, .input50, ' +
    '.input51, .input52, .input53, .input54, .input55, ' +
    '.input56, .input57, .input58, .input59, .input60'
  );

  const controles = document.querySelector('.peer-controls');
  const botonesPeligrosos = document.querySelectorAll(
    'button[onclick="confirmarBorrado()"], ' +
    'button[onclick="confirmarEnvioExcel()"]'
  );

  if (modoSoloLectura) {
    // Bloquear todos los inputs
    elementos.forEach(el => {
      el.classList.add('bloqueado');
      el.setAttribute('readonly', 'true');
      el.disabled = true;
    });

    // Marcar visualmente el panel de controles
    if (controles) {
      controles.classList.add('modo-lectura-activo');
    }

    // Deshabilitar botones peligrosos
    botonesPeligrosos.forEach(btn => {
      btn.classList.add('bloqueado');
      btn.disabled = true;
    });

  } else {
    // Desbloquear todo
    elementos.forEach(el => {
      el.classList.remove('bloqueado');
      el.removeAttribute('readonly');
      el.disabled = false;
    });

    if (controles) {
      controles.classList.remove('modo-lectura-activo');
    }

    botonesPeligrosos.forEach(btn => {
      btn.classList.remove('bloqueado');
      btn.disabled = false;
    });
  }
}

// Enviar estado de modo lectura al otro dispositivo
function enviarModoLectura(forzar = false) {
  if (!conexion || !conexion.open) return;

  const mensaje = {
    tipo: 'modo_lectura',
    activar: forzar,
    timestamp: Date.now()
  };

  try {
    conexion.send(mensaje);
    console.log('ðŸ“¤ Modo lectura enviado:', mensaje);
  } catch (error) {
    console.error('Error al enviar modo lectura:', error);
  }
}

// Activar modo lectura para el cliente conectado
function activarModoLecturaCliente() {
  if (!esAnfitrion) {
    Swal.fire({
      icon: 'warning',
      title: 'Sin permisos',
      text: 'Solo el anfitriÃ³n puede controlar el modo lectura.',
      timer: 2000
    });
    return;
  }

  Swal.fire({
    title: 'Â¿Activar modo solo lectura?',
    text: 'El dispositivo conectado no podrÃ¡ editar datos.',
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: 'SÃ­, activar',
    cancelButtonText: 'Cancelar',
    confirmButtonColor: '#f44336'
  }).then((result) => {
    if (result.isConfirmed) {
      enviarModoLectura(true);
      
      Swal.fire({
        icon: 'success',
        title: 'Modo Activado',
        text: 'El otro dispositivo ahora estÃ¡ en modo solo lectura.',
        timer: 2000,
        showConfirmButton: false
      });
    }
  });
}
    // MEJORA: Configurar inputs para mejor rendimiento
    function configurarInputsParaSincronizacion() {
      const inputs = document.querySelectorAll('input[type="tel"], input.cantidad, input.cantidad2, input.cantidad4, .venta, .input1, .input2, .input3, .input4, .input5, .input6, .input7, .input8, .input9, .input10, .input11, .input12, .input13, .input14, .input15, .input16, .input17, .input18, .input19, .input20, .input21, .input22, .input23, .input24, .input25, .input26, .input27, .input28, .input29, .input30, .input31, .input32, .input33, .input34, .input35, .input36, .input37, .input38, .input39, .input40, .input41, .input42, .input43, .input44, .input45, .input46, .input47, .input48, .input49, .input50, .input51, .input52, .input53, .input54, .input55, .input56, .input57, .input58, .input59, .input60');

      inputs.forEach(input => {
        input.addEventListener('input', function (e) {
          setTimeout(() => {
            if (sincronizacionActiva && conexion && conexion.open) {
              enviarDatosDebounced();
            }
          }, 100);
        });

        input.addEventListener('paste', function (e) {
          setTimeout(() => {
            if (sincronizacionActiva && conexion && conexion.open) {
              setTimeout(() => {
                enviarDatos();
              }, 300);
            }
          }, 50);
        });

        input.addEventListener('blur', function () {
          if (sincronizacionActiva && conexion && conexion.open) {
            enviarDatos();
          }
        });
      });
    }

    // MEJORA: Debounce mejorado para envÃ­o de datos
    let timeoutEnvio = null;
    function enviarDatosDebounced() {
      clearTimeout(timeoutEnvio);
      timeoutEnvio = setTimeout(() => {
        if (conexion && conexion.open) {
          enviarDatos();
        }
      }, 1500);
    }

    // MEJORA: FunciÃ³n para suspender temporalmente la sincronizaciÃ³n
    function suspenderSincronizacion(tiempoMs = 1000) {
      sincronizacionActiva = false;
      setTimeout(() => {
        sincronizacionActiva = true;
      }, tiempoMs);
    }

    // NUEVA FUNCIÃ“N: Guardar cambios confirmados
    function guardarCambiosConfirmados() {
      if (conexion && conexion.open) {
        Swal.fire({
          title: 'Â¿Guardar cambios confirmados?',
          text: 'Esta acciÃ³n garantizarÃ¡ que los cambios se sincronicen permanentemente en ambos dispositivos.',
          icon: 'question',
          showCancelButton: true,
          confirmButtonText: 'SÃ­, guardar cambios',
          cancelButtonText: 'Cancelar',
          confirmButtonColor: '#9C27B0'
        }).then((result) => {
          if (result.isConfirmed) {
            // Forzar guardado en localStorage de ambos dispositivos
            guardarLocalmente();

            // Enviar datos con flag especial de confirmaciÃ³n
            const datos = obtenerTodosLosDatos();
            datos.tipo = 'confirmacion_cambios';
            datos.timestampConfirmacion = Date.now();
            datos.mensaje = 'Cambios confirmados y guardados permanentemente';

            try {
              conexion.send(datos);
              console.log('âœ… Cambios confirmados enviados:', datos);

              // Guardar estado confirmado en localStorage
              localStorage.setItem('ultima-confirmacion', Date.now().toString());
              localStorage.setItem('datos-confirmados', JSON.stringify(datos));

              Swal.fire({
                icon: 'success',
                title: 'Cambios Guardados',
                text: 'Los cambios han sido confirmados y sincronizados permanentemente en ambos dispositivos.',
                timer: 2500,
                showConfirmButton: false
              });
            } catch (error) {
              console.error('Error al enviar confirmaciÃ³n:', error);
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'No se pudieron guardar los cambios. Verifica la conexiÃ³n.'
              });
            }
          }
        });
      } else {
        Swal.fire({
          icon: 'warning',
          title: 'Sin conexiÃ³n',
          text: 'Debes estar conectado a otro dispositivo para guardar cambios confirmados.'
        });
      }
    }

    // Inicializar PeerJS con ID persistente
    function inicializarPeerJS() {
      const peerId = obtenerPeerIdPersistente();

      peer = new Peer(peerId, {
        debug: 1,
        config: {
          'iceServers': [
            { urls: 'stun:stun.l.google.com:19302' },
            { urls: 'stun:global.stun.twilio.com:3478' }
          ]
        }
      });

      peer.on('open', (id) => {
        miID = id;
        console.log('Mi ID persistente:', id);

        const idCorto = id.length > 8 ? id.substring(0, 8) + '...' : id;
        document.getElementById('miIDBtn').textContent = `Mi ID: ${idCorto}`;
        document.getElementById('miIDBtn').style.display = 'block';
// DETERMINAR ROL BASADO EN ID FIJO
        esAnfitrion = esDispositivoAnfitrion();
        mostrarRolDispositivo();
        
        if (esAnfitrion) {
          console.log('ðŸ‘‘ Este dispositivo es el ANFITRIÃ“N FIJO permanente');
        } else {
          console.log('ðŸ“± Este dispositivo es CLIENTE');
        }
        configurarInputsParaSincronizacion();

        const idRemotoGuardado = localStorage.getItem('peer-remote-id');
        if (idRemotoGuardado && idRemotoGuardado !== id) {
          setTimeout(() => {
            conectarAutomaticamente(idRemotoGuardado);
          }, 1500);
        }

        actualizarEstadoConexion();
      });

     peer.on('connection', (conn) => {
        console.log('ðŸ“² ConexiÃ³n entrante recibida de:', conn.peer);
        
        // VALIDAR QUE ESTE DISPOSITIVO ES EL ANFITRIÃ“N
        if (!esDispositivoAnfitrion()) {
          console.error('â›” Este dispositivo NO es el anfitriÃ³n. Rechazando conexiÃ³n entrante.');
          conn.close();
          
          Swal.fire({
            icon: 'error',
            title: 'ConexiÃ³n Rechazada',
            text: 'Este dispositivo es CLIENTE y no puede aceptar conexiones entrantes.',
            timer: 3000
          });
          return;
        }
        
        console.log('ðŸ‘‘ AnfitriÃ³n aceptando conexiÃ³n entrante');
        esAnfitrion = true;
        manejarNuevaConexion(conn);

        localStorage.setItem('peer-remote-id', conn.peer);
      });

      peer.on('error', (err) => {
        console.error('Error en PeerJS:', err);
        if (err.type === 'peer-unavailable') {
          intentarReconexion();
        }
      });

      peer.on('disconnected', () => {
        console.log('Peer desconectado, intentando reconectar...');
        peer.reconnect();
      });

      peer.on('close', () => {
        console.log('Peer cerrado');
        actualizarEstadoConexion();
      });
    }

    // Conectar automÃ¡ticamente
    function conectarAutomaticamente(idRemoto) {
      if (!peer || !peer.open) {
        setTimeout(() => conectarAutomaticamente(idRemoto), 1000);
        return;
      }

      console.log('Intentando reconexiÃ³n automÃ¡tica a:', idRemoto);
      intentandoReconectar = true;

      conexion = peer.connect(idRemoto, {
        reliable: true,
        serialization: 'json'
      });

      configurarEventosConexion(conexion);

      localStorage.setItem('peer-remote-id', idRemoto);
      esAnfitrion = esDispositivoAnfitrion(); // Usar siempre el rol basado en ID
      // LIMPIAR DATOS DEL CLIENTE EN RECONEXIÃ“N AUTOMÃTICA
      console.log('ðŸ—‘ï¸ Limpiando datos del cliente para reconexiÃ³n automÃ¡tica...');
      
      document.querySelectorAll("input, textarea").forEach(el => {
        el.value = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      document.querySelectorAll(".resultado, td[class^='r'], .cantidad3, .cantidad5, .resultado-adicionales").forEach(el => {
        el.textContent = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      console.log('âœ… Cliente limpiado para reconexiÃ³n');
    }

    // Conectar manualmente
    function conectarDispositivo() {
      const idRemoto = prompt('Ingresa el ID del otro dispositivo:');
      if (!idRemoto || idRemoto === miID) return;

      Swal.fire({
        title: 'Conectando...',
        text: 'Estableciendo conexiÃ³n con el otro dispositivo',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      conexion = peer.connect(idRemoto, {
        reliable: true,
        serialization: 'json'
      });

      configurarEventosConexion(conexion);

      localStorage.setItem('peer-remote-id', idRemoto);
     esAnfitrion = esDispositivoAnfitrion(); // Usar siempre el rol basado en ID
      // LIMPIAR DATOS DEL CLIENTE ANTES DE CONECTAR
      console.log('ðŸ—‘ï¸ Limpiando datos del cliente antes de conectar...');
      
      document.querySelectorAll("input, textarea").forEach(el => {
        el.value = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      document.querySelectorAll(".resultado, td[class^='r'], .cantidad3, .cantidad5, .resultado-adicionales").forEach(el => {
        el.textContent = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      console.log('âœ… Datos del cliente limpiados, conectando...');
    }

    // Configurar eventos de conexiÃ³n
// Configurar eventos de conexiÃ³n
function configurarEventosConexion(conn) {
  conn.on('open', () => {
    console.log('âœ… ConexiÃ³n establecida exitosamente!');
    conexion = conn;
    intentandoReconectar = false;
// FORZAR MODO SOLO LECTURA EN CLIENTE
    if (!esAnfitrion) {
      modoSoloLectura = true;
      esModoLecturaForzado = true;
      aplicarModoLectura();
      console.log('ðŸ”’ Cliente bloqueado en modo solo lectura');
    }
    // BORRAR TODOS LOS DATOS DEL CLIENTE ANTES DE RECIBIR DEL ANFITRIÃ“N
    if (!esAnfitrion) {
      console.log('ðŸ—‘ï¸ Limpiando datos del cliente antes de sincronizar con anfitriÃ³n...');
      
      // Borrar todos los inputs
      document.querySelectorAll("input, textarea").forEach(el => {
        el.value = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      // Borrar resultados y celdas
      document.querySelectorAll(".resultado, td[class^='r']").forEach(el => {
        el.textContent = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      // Borrar divs especiales
      document.querySelectorAll(".cantidad3, .cantidad5, .resultado-adicionales").forEach(el => {
        el.textContent = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      // Limpiar totales visuales
      const totalBilteles = document.getElementById("total-general-bilteles");
      const totalMonedas = document.getElementById("total-general-monedas");
      const sumaTotal = document.getElementById("suma-total");
      const resul = document.getElementById("resul");
      const sobra = document.getElementById("sobra");
      
      if (totalBilteles) totalBilteles.textContent = "";
      if (totalMonedas) totalMonedas.textContent = "";
      if (sumaTotal) sumaTotal.textContent = "";
      if (resul) resul.textContent = "";
      if (sobra) sobra.textContent = "";

      console.log('âœ… Datos del cliente limpiados, esperando datos del anfitriÃ³n...');
    }
    Swal.close();
    Swal.fire({
      icon: 'success',
      title: 'Â¡Conectado!',
      text: 'ConexiÃ³n establecida exitosamente',
      timer: 2000,
      showConfirmButton: false
    });

    // IMPORTANTE: El cliente NO envÃ­a datos inmediatamente
    // Solo espera recibir los datos del anfitriÃ³n
    console.log('â³ Cliente esperando datos del anfitriÃ³n...');

    actualizarEstadoConexion();

    conn.on('close', () => {
      console.log('ConexiÃ³n cerrada');
      primeraConexion = true; // Resetear
      actualizarEstadoConexion();
      intentarReconexion();
    });

    conn.on('error', (err) => {
      console.error('Error en la conexiÃ³n:', err);
      primeraConexion = true; // Resetear
    });
  });

  conn.on('data', (datos) => {
    console.log('ðŸ“¥ Datos recibidos:', datos);

    // Verificar si es una confirmaciÃ³n especial
    if (datos.tipo === 'confirmacion_cambios') {
      console.log('âœ… ConfirmaciÃ³n de cambios recibida:', datos.mensaje);

      aplicarDatosRecibidos(datos);
      localStorage.setItem('ultima-confirmacion', Date.now().toString());
      localStorage.setItem('datos-confirmados', JSON.stringify(datos));

      if (datos.esAnfitrion !== esAnfitrion) {
        Swal.fire({
          icon: 'success',
          title: 'Cambios Confirmados',
          text: 'El otro dispositivo ha confirmado y guardado los cambios permanentemente.',
          timer: 2500,
          showConfirmButton: false
        });
      }
    } else if (datos.tipo === 'modo_lectura') {
      // Ya se procesa en aplicarDatosRecibidos
      aplicarDatosRecibidos(datos);
    } else {
      // Cliente recibe y aplica datos del anfitriÃ³n
      aplicarDatosRecibidos(datos);
      guardarLocalmente();
      
      // DespuÃ©s de recibir datos del anfitriÃ³n, el cliente puede enviar actualizaciones
      if (primeraConexion) {
        setTimeout(() => {
          primeraConexion = false;
          console.log('âœ… Cliente sincronizado, puede enviar actualizaciones');
        }, 1000);
      }
    }
  });

  conn.on('error', (err) => {
    console.error('âŒ Error al conectar:', err);
    Swal.fire({
      icon: 'error',
      title: 'Error de conexiÃ³n',
      text: 'No se pudo conectar al dispositivo. Verifica el ID e intenta nuevamente.',
    });
    primeraConexion = true; // Resetear
    intentarReconexion();
  });
}

    // Manejar nueva conexiÃ³n entrante
// Manejar nueva conexiÃ³n entrante
function manejarNuevaConexion(conn) {
  conexion = conn;

  conn.on('open', () => {
    console.log('âœ… Cliente conectado:', conn.peer);
    actualizarEstadoConexion();
// ENVIAR MODO LECTURA FORZADO AL CLIENTE
    setTimeout(() => {
      enviarModoLectura(true);
      console.log('ðŸ“¤ Modo lectura forzado enviado al cliente');
    }, 500);
    // IMPORTANTE: El anfitriÃ³n envÃ­a sus datos inmediatamente
    setTimeout(() => {
      console.log('ðŸ“¤ AnfitriÃ³n enviando datos al cliente...');
      enviarDatos();
      
      // Enviar una segunda vez para asegurar sincronizaciÃ³n completa
      setTimeout(() => {
        enviarDatos();
        console.log('ðŸ“¤ Segunda sincronizaciÃ³n del anfitriÃ³n completada');
      }, 500);
    }, 300);
  });

  conn.on('data', (datos) => {
    console.log('ðŸ“¥ Datos recibidos del cliente:', datos);

    if (datos.tipo === 'confirmacion_cambios') {
      console.log('âœ… ConfirmaciÃ³n de cambios recibida del cliente');

      aplicarDatosRecibidos(datos);
      guardarLocalmente();

      localStorage.setItem('ultima-confirmacion', Date.now().toString());
      localStorage.setItem('datos-confirmados', JSON.stringify(datos));
    } else if (datos.tipo === 'modo_lectura') {
      // Procesar cambio de modo lectura
      return;
    } else {
      // CRÃTICO: El anfitriÃ³n NO debe aplicar datos del cliente en la primera conexiÃ³n
      // Solo actualiza despuÃ©s de que ya sincronizÃ³ sus datos
      if (!primeraConexion) {
        aplicarDatosRecibidos(datos);
        guardarLocalmente();
      } else {
        console.log('â­ï¸ Ignorando datos iniciales del cliente (anfitriÃ³n tiene prioridad)');
        
        // DespuÃ©s de ignorar, permitir sincronizaciÃ³n bidireccional
        setTimeout(() => {
          primeraConexion = false;
          console.log('âœ… Primera conexiÃ³n completada, sincronizaciÃ³n bidireccional activada');
        }, 2000);
      }
    }
  });

  conn.on('close', () => {
    console.log('Cliente desconectado');
    primeraConexion = true; // Resetear para prÃ³xima conexiÃ³n
    actualizarEstadoConexion();
  });

  conn.on('error', (err) => {
    console.error('Error en conexiÃ³n entrante:', err);
    primeraConexion = true; // Resetear en caso de error
  });
}

    // Enviar datos a travÃ©s de la conexiÃ³n P2P
    function enviarDatos() {
  // SOLO EL ANFITRIÃ“N PUEDE ENVIAR DATOS
  if (!esDispositivoAnfitrion()) {
    console.log('ðŸš« Este dispositivo es CLIENTE - no puede enviar datos (solo lectura)');
    return;
  }
  
  if (!conexion || !conexion.open) return;

      const datos = obtenerTodosLosDatos();

      try {
        conexion.send(datos);
        console.log('ðŸ“¤ Datos enviados:', datos);
      } catch (error) {
        console.error('Error al enviar datos:', error);
      }
    }

    // Obtener todos los datos de la pÃ¡gina
    function obtenerTodosLosDatos() {
      const datos = {
        campos: {},
        celdas: {},
        divs: {},
        localStorage: {},
        timestamp: Date.now(),
        esAnfitrion: esAnfitrion
      };

      document.querySelectorAll("input, textarea, select").forEach((campo, index) => {
        const clave = campo.id || campo.name || `campo-${index}`;
        datos.campos[clave] = campo.value;

        if (campo.dataset.valor !== undefined) {
          datos.campos[clave + '_dataset'] = campo.dataset.valor;
        }
      });

      document.querySelectorAll("td[class^='r'], td.resultado, td.valor-fijo").forEach((celda, index) => {
        const clave = celda.className || `celda-${index}`;
        datos.celdas[clave] = celda.textContent;
      });

      const divsEspeciales = document.querySelectorAll('.cantidad3, .cantidad5, .resultado-adicionales');
      divsEspeciales.forEach((div, index) => {
        const clave = div.className || `div-${index}`;
        datos.divs[clave] = div.textContent;
        if (div.dataset.valor) {
          datos.divs[clave + '_dataset'] = div.dataset.valor;
        }
      });

      const keysToSync = ['premios-total', 'peer-remote-id', 'ultima-confirmacion'];
      keysToSync.forEach(key => {
        datos.localStorage[key] = localStorage.getItem(key);
      });

      return datos;
    }

    // MEJORA: Optimizar la aplicaciÃ³n de datos recibidos
    function aplicarDatosRecibidos(datos) {
      // AGREGAR ESTO AL PRINCIPIO:// AGREGAR ESTO AL PRINCIPIO (despuÃ©s del manejo de modo_lectura):
  if (datos.tipo === 'modo_lectura') {
    esModoLecturaForzado = datos.activar;
    modoSoloLectura = datos.activar;
    aplicarModoLectura();
    
    if (datos.activar) {
      Swal.fire({
        icon: 'warning',
        title: 'Modo Solo Lectura Activado',
        text: 'El anfitriÃ³n ha bloqueado la ediciÃ³n en este dispositivo.',
        timer: 3000
      });
    }
    return;
  }

  // AGREGAR ESTA PROTECCIÃ“N:
  // Si es anfitriÃ³n en primera conexiÃ³n, ignorar datos entrantes
  if (esAnfitrion && primeraConexion) {
    console.log('â­ï¸ AnfitriÃ³n ignorando datos iniciales (prioridad anfitriÃ³n)');
    return;
  }
  if (datos.tipo === 'modo_lectura') {
    esModoLecturaForzado = datos.activar;
    modoSoloLectura = datos.activar;
    aplicarModoLectura();
    
    if (datos.activar) {
      Swal.fire({
        icon: 'warning',
        title: 'Modo Solo Lectura Activado',
        text: 'El anfitriÃ³n ha bloqueado la ediciÃ³n en este dispositivo.',
        timer: 3000
      });
    }
    return;
  }
      if (datos.timestamp && ultimoTimestampRecibido &&
        datos.timestamp <= ultimoTimestampRecibido) {
        return;
      }
      ultimoTimestampRecibido = datos.timestamp;

      sincronizacionActiva = false;

      if (datos.campos) {
        Object.keys(datos.campos).forEach(clave => {
          if (clave.endsWith('_dataset')) return;

          const valor = datos.campos[clave];

          let campo = document.getElementById(clave) ||
            document.querySelector(`[name="${clave}"]`);

          if (!campo && clave.startsWith('campo-')) {
            const index = parseInt(clave.replace('campo-', ''));
            const campos = document.querySelectorAll("input, textarea, select");
            if (campos[index]) campo = campos[index];
          }

          if (campo && campo.value !== valor) {
            const estaEnfocado = (document.activeElement === campo);

            if (!estaEnfocado) {
              campo.value = valor;

              const datasetKey = clave + '_dataset';
              if (datos.campos[datasetKey] && campo.dataset.valor !== undefined) {
                campo.dataset.valor = datos.campos[datasetKey];
              }

              const event = new Event('input', { bubbles: true });
              campo.dispatchEvent(event);
            }
          }
        });
      }

      if (datos.celdas) {
        Object.keys(datos.celdas).forEach(clave => {
          const celdas = document.querySelectorAll(`.${clave}`);
          celdas.forEach(celda => {
            if (celda.textContent !== datos.celdas[clave]) {
              celda.textContent = datos.celdas[clave];
            }
          });
        });
      }

      if (datos.divs) {
        Object.keys(datos.divs).forEach(clave => {
          if (clave.endsWith('_dataset')) return;

          const div = document.querySelector(`.${clave}`);
          if (div && div.textContent !== datos.divs[clave]) {
            div.textContent = datos.divs[clave];

            const datasetKey = clave + '_dataset';
            if (datos.divs[datasetKey] && div.dataset.valor !== undefined) {
              div.dataset.valor = datos.divs[datasetKey];
            }
          }
        });
      }

      if (datos.localStorage) {
        Object.keys(datos.localStorage).forEach(key => {
          if (datos.localStorage[key] !== null) {
            localStorage.setItem(key, datos.localStorage[key]);
          }
        });
      }

      setTimeout(() => {
        if (typeof calcularTotales === 'function') calcularTotales();
        if (typeof verificarCamposVacios === 'function') verificarCamposVacios();
        if (typeof sumarInputsImpares === 'function') sumarInputsImpares();
        if (typeof sumarResultados === 'function') sumarResultados();
        if (typeof sumarConteoBilletes === 'function') sumarConteoBilletes();

        setTimeout(() => {
          sincronizacionActiva = true;
        }, 500);
      }, 100);
    }

    // Intentar reconexiÃ³n automÃ¡tica
    function intentarReconexion() {
      if (intentandoReconectar) return;

      const idRemoto = localStorage.getItem('peer-remote-id');
      if (!idRemoto || idRemoto === miID) return;

      intentandoReconectar = true;

      console.log('Intentando reconexiÃ³n en 5 segundos...');

      if (reconnectInterval) clearInterval(reconnectInterval);

      reconnectInterval = setInterval(() => {
        if (!conexion || !conexion.open) {
          conectarAutomaticamente(idRemoto);
        } else {
          clearInterval(reconnectInterval);
          intentandoReconectar = false;
        }
      }, 5000);
    }

    // Actualizar estado de conexiÃ³n en UI (MODIFICADA PARA INCLUIR BOTÃ“N GUARDAR)
function actualizarEstadoConexion() {
  const statusEl = document.getElementById('peerStatus');
  const disconnectBtn = document.getElementById('disconnectBtn');
  const connectBtn = document.getElementById('connectBtn');
  const guardarBtn = document.getElementById('guardarCambiosBtn');

if (conexion && conexion.open) {
    const rol = esDispositivoAnfitrion() ? 'ANFITRIÃ“N FIJO' : 'CLIENTE';
    statusEl.textContent = `Conectado (${rol})`;
    statusEl.className = 'peer-status connected';
    disconnectBtn.style.display = 'block';
    connectBtn.style.display = 'none';
    guardarBtn.style.display = 'block';

} else {
    const rol = esDispositivoAnfitrion() ? 'ANFITRIÃ“N' : 'CLIENTE';
    const color = esDispositivoAnfitrion() ? '#4CAF50' : '#2196F3';
    statusEl.innerHTML = `Sin conexiÃ³n - <strong style="color: ${color}">${rol}</strong>`;
    statusEl.className = 'peer-status disconnected';
    disconnectBtn.style.display = 'none';
    connectBtn.style.display = 'block';
    guardarBtn.style.display = 'none';

  }
}

    // Desconectar
 // Desconectar
function desconectar() {
  if (conexion) {
    conexion.close();
    conexion = null;
  }

  if (peer) {
    peer.disconnect();
  }

  localStorage.removeItem('peer-remote-id');
  esAnfitrion = false;
  primeraConexion = true; // RESETEAR VARIABLE

  Swal.fire({
    icon: 'info',
    title: 'Desconectado',
    text: 'Se ha cerrado la conexiÃ³n',
    timer: 1500,
    showConfirmButton: false
  });

  actualizarEstadoConexion();
}

    // Copiar mi ID
    function copiarMiID() {
      Swal.fire({
        title: 'Mi ID',
        text: `ID actual: ${miID}`,
        icon: 'info',
        showCancelButton: true,
        confirmButtonText: 'Copiar',
        cancelButtonText: 'Cambiar ID',
        showDenyButton: true,
        denyButtonText: 'Cerrar'
      }).then((result) => {
        if (result.isConfirmed) {
          navigator.clipboard.writeText(miID).then(() => {
            Swal.fire({
              icon: 'success',
              title: 'ID copiado',
              text: 'ID copiado al portapapeles',
              timer: 1500,
              showConfirmButton: false
            });
          }).catch(() => {
            prompt('Copia este ID manualmente:', miID);
          });
        } else if (result.dismiss === Swal.DismissReason.cancel) {
          Swal.fire({
            title: 'Cambiar ID',
            input: 'text',
            inputLabel: 'Nuevo ID',
            inputValue: miID,
            showCancelButton: true,
            confirmButtonText: 'Guardar',
            cancelButtonText: 'Cancelar',
            inputValidator: (value) => {
              if (!value) {
                return 'Debes ingresar un ID';
              }
            }
          }).then((result) => {
            if (result.isConfirmed) {
              const nuevoId = result.value;
              localStorage.setItem('peer-id-persistente', nuevoId);
              Swal.fire({
                icon: 'success',
                title: 'ID guardado',
                text: 'El ID ha sido cambiado. La pÃ¡gina se recargarÃ¡ para aplicar los cambios.',
                timer: 2000,
                showConfirmButton: false
              }).then(() => {
                location.reload();
              });
            }
          });
        }
      });
    }

    // Guardar datos localmente
    function guardarLocalmente() {
      document.querySelectorAll("input, textarea, select").forEach((campo, index) => {
        const key = campo.id || campo.name || `campo-${index}`;
        localStorage.setItem(key, campo.value);

        if (campo.dataset.valor) {
          localStorage.setItem(`${key}-dataset`, campo.dataset.valor);
        }
      });

      document.querySelectorAll("td[class^='r']").forEach((celda, index) => {
        localStorage.setItem(`td-${index}`, celda.textContent.trim());
      });

      localStorage.setItem('ultima-sincronizacion', Date.now());
    }

    // ============================================
    // FUNCIONES EXISTENTES DE LA APLICACIÃ“N ORIGINAL
    // ============================================

    // Calcular totales
    function calcularTotales() {
      let totalBilteles = 0;
      let totalMonedas = 0;
      let totalAdicionales = 0;
      let totalPremios = 0;
      let totalVenta = 0;

      const filas = document.querySelectorAll("tbody tr");

      filas.forEach(fila => {
        const valores = fila.querySelectorAll(".valor-fijo");
        const cantidades = fila.querySelectorAll(".cantidad");
        const resultados = fila.querySelectorAll(".resultado");

        for (let i = 0; i < valores.length; i++) {
          const valorTexto = valores[i]?.innerText?.replace(/[^\d.]/g, "") || "0";
          const valor = parseFloat(valorTexto) || 0;
          const cantidad = parseFloat(cantidades[i]?.value) || 0;
          const total = valor * cantidad;

          if (resultados[i]) {
            resultados[i].innerText = total.toLocaleString("es-CO");
          }

          if (resultados[i]?.classList.contains("resultado-bilteles")) {
            totalBilteles += total;
          }
          if (resultados[i]?.classList.contains("resultado-monedas")) {
            totalMonedas += total;
          }
        }
      });

      const adicionalesInputs = document.querySelectorAll("input.cantidad2");
      adicionalesInputs.forEach(input => {
        const val = parseFloat(input.dataset.valor || "0");
        totalAdicionales += val;
      });

      const premiosDiv = document.querySelector(".cantidad3");
      if (premiosDiv) {
        const valorPremio = parseFloat(premiosDiv.dataset.valor || "0");
        totalPremios = valorPremio;
      }

      const ventaInput = document.querySelector("input.venta");
      if (ventaInput) {
        const valorVenta = parseFloat(ventaInput.dataset.valor || "0");
        totalVenta = valorVenta;
      }

      const totalBiltelesEl = document.getElementById("total-general-bilteles");
      if (totalBiltelesEl) totalBiltelesEl.innerText = totalBilteles.toLocaleString("es-CO");

      const totalMonedasEl = document.getElementById("total-general-monedas");
      if (totalMonedasEl) totalMonedasEl.innerText = totalMonedas.toLocaleString("es-CO");

      const adicionalesEl = document.querySelector(".resultado-adicionales");
      if (adicionalesEl) adicionalesEl.innerText = totalAdicionales.toLocaleString("es-CO");

      const sumaTotal = totalBilteles + totalMonedas + totalAdicionales + totalPremios;
      const sumaTotalEl = document.getElementById("suma-total");
      if (sumaTotalEl) sumaTotalEl.innerText = sumaTotal.toLocaleString("es-CO");

      const resultadoResta = sumaTotal - totalVenta;
      const resulEl = document.getElementById("resul");
      const sobraEl = document.getElementById("sobra");

      if (resulEl) {
        resulEl.innerText = resultadoResta.toLocaleString("es-CO");
        resulEl.classList.remove("exacto", "sobra", "falta");
        if (resultadoResta > 0) {
          resulEl.classList.add("sobra");
        } else if (resultadoResta < 0) {
          resulEl.classList.add("falta");
        } else {
          resulEl.classList.add("exacto");
        }
      }

      if (sobraEl) {
        sobraEl.classList.remove("exacto", "sobra", "falta");
        if (resultadoResta > 0) {
          sobraEl.innerText = "Sobra";
          sobraEl.classList.add("sobra");
        } else if (resultadoResta < 0) {
          sobraEl.innerText = "Falta";
          sobraEl.classList.add("falta");
        } else {
          sobraEl.innerText = "Exacto";
          sobraEl.classList.add("exacto");
        }
      }

      verificarCamposVacios();
    }

    // Verificar campos vacÃ­os
    function verificarCamposVacios() {
      const verificaciones = [
        { inputId: "nequi1", celdaId: "nequi" },
        { inputId: "alfonso1", celdaId: "alfonso" },
        { inputId: "descuadre1", celdaId: "descuadre" },
        { inputId: "mio1", celdaId: "mio" },
        { inputId: "Avances1", celdaId: "Avances" }
      ];

      verificaciones.forEach(({ inputId, celdaId }) => {
        const input = document.getElementById(inputId);
        const celda = document.getElementById(celdaId);

        if (input && celda) {
          if (input.value.trim() === "") {
            celda.style.backgroundColor = "red";
          } else {
            celda.style.backgroundColor = "";
          }
        }
      });

      const inputsCantidad4 = document.querySelectorAll("input.cantidad4");
      inputsCantidad4.forEach(input => {
        const valorNumerico = input.value.replace(/\D/g, "");
        if (valorNumerico !== "") {
          input.style.backgroundColor = "#d6b3f8";
        } else {
          input.style.backgroundColor = "";
        }
      });
    }

    // Lista de loterÃ­as para autocompletado
    const loterias = [
      "Lote Cundi", "Lote Tolima", "Lote Cruz Roja", "Lote Huila", "Lote Meta", "Lote Valle",
      "Lote Manizales", "Lote Bogota", "Lote Quindio", "Lote Risaralda", "Lote Medellin",
      "Lote Santander", "Lote Boyaca", "Lote Cauca", "Extra Colombia", "Quinta", "Astro",
      "Miloto", "Baloto", "Colorloto", "Pagamillonario", "Chancemillonario", "RaspaTodo",
      "PagatÃ³n", "Maxichance", "Betplay", "Paga Triple", "Linea Cundi", "Linea Tolima",
      "Linea Cruz Roja", "Linea Huila", "Linea Meta", "Linea Valle", "Linea Manizales",
      "Linea Bogota", "Linea Quindio", "Linea Risaralda", "Linea Medellin", "Linea Santander",
      "Linea Boyaca", "Linea Cauca", "Paga Encime", "Chance", "Cabezote", "Otros Premios", "Rifas"
    ];

    // Configurar autocompletado
    function setupAutoComplete(inputId, sugerenciasId) {
      const input = document.getElementById(inputId);
      const sugerencias = document.getElementById(sugerenciasId);

      if (!input || !sugerencias) return;

      input.addEventListener('input', () => {
        const valor = input.value.toLowerCase();
        sugerencias.innerHTML = '';
        sugerencias.style.display = 'none';

        if (valor) {
          const coincidencias = loterias.filter(dep =>
            dep.toLowerCase().includes(valor)
          );

          if (coincidencias.length > 0) {
            sugerencias.style.display = 'block';
            coincidencias.forEach(dep => {
              const li = document.createElement('li');
              li.textContent = dep;
              li.style.cursor = 'pointer';
              li.onclick = () => {
                input.value = dep;
                localStorage.setItem(input.id || input.name, dep);
                sugerencias.style.display = 'none';
                input.dispatchEvent(new Event('input'));
              };
              sugerencias.appendChild(li);
            });
          }
        }
      });

      document.addEventListener('click', e => {
        if (!sugerencias.contains(e.target) && e.target !== input) {
          sugerencias.style.display = 'none';
        }
      });
    }

    // Calcular resultado por input
    function calcularResultadoPorInput(input) {
      const clases = Array.from(input.classList);
      const claseInput = clases.find(c => /^input\d+$/.test(c));
      if (!claseInput) return;

      const numeroClase = parseInt(claseInput.replace('input', ''));
      const fila = Math.ceil(numeroClase / 2);
      calcularResultado(fila);
    }

    // Calcular resultado de una fila
    function calcularResultado(fila) {
      const claseA = `input${((fila - 1) * 2) + 1}`;
      const claseB = `input${((fila - 1) * 2) + 2}`;

      const inputA = document.querySelector(`input.${claseA}`);
      const inputB = document.querySelector(`input.${claseB}`);
      const celdaResultado = document.querySelector(`.r${fila}`);

      if (!inputA || !inputB || !celdaResultado) return;

      const valA = inputA.value.replace(/\./g, '').replace(',', '.');
      const valB = inputB.value.replace(/\./g, '').replace(',', '.');

      const numA = parseFloat(valA) || 0;
      const numB = parseFloat(valB) || 0;

      if (!isNaN(numA) && !isNaN(numB)) {
        const resultado = (numA * numB);
        celdaResultado.textContent = resultado.toLocaleString('es-CO');
        celdaResultado.dataset.valor = resultado.toString();
      } else {
        celdaResultado.textContent = '';
        celdaResultado.dataset.valor = '0';
      }

      sumarResultados();
    }

    // Sumar todos los resultados
    function sumarResultados() {
      let total = 0;

      for (let i = 1; i <= 30; i++) {
        const celda = document.querySelector(`.r${i}`);
        if (!celda) continue;

        const texto = celda.textContent.replace(/\./g, '').replace(',', '.');
        const numero = parseFloat(texto) || 0;

        total += numero;
      }

      const divCantidad3 = document.querySelector('.cantidad3');
      if (divCantidad3) {
        divCantidad3.textContent = total.toLocaleString('es-CO');
        divCantidad3.dataset.valor = total.toString();
        localStorage.setItem("premios-total", total.toString());
      }

      calcularTotales();
    }

    // FunciÃ³n para detectar fila desde input
    function detectarFila(input) {
      const clases = Array.from(input.classList);
      const claseInput = clases.find(c => /^input\d+$/.test(c));
      if (!claseInput) return;

      const numeroClase = parseInt(claseInput.replace('input', ''));
      const fila = Math.ceil(numeroClase / 2);
      calcularResultado(fila);
    }

    // Formatear miles
    function formatearMiles(input) {
      const valor = input.value.replace(/\D/g, "");
      if (valor === "") {
        input.value = "";
        input.dataset.valor = "0";
      } else {
        const numero = parseInt(valor);
        input.dataset.valor = numero;
        input.value = numero.toLocaleString("es-CO");
      }

      if (input.classList.contains('input1') || input.classList.contains('input2') ||
        /^input\d+$/.test(Array.from(input.classList).find(c => /^input\d+$/.test(c)))) {
        detectarFila(input);
      }

      calcularTotales();
      verificarCamposVacios();
    }

    // Sumar inputs impares
    function sumarInputsImpares() {
      let suma = 0;

      for (let i = 1; i <= 60; i += 2) {
        const input = document.querySelector(`input.input${i}`);
        if (input) {
          const valor = parseFloat(input.value.replace(/\./g, '').replace(',', '.')) || 0;
          suma += valor;
        }
      }

      const campoCantidad5 = document.querySelector(".cantidad5");
      if (campoCantidad5) {
        campoCantidad5.textContent = suma.toLocaleString("es-CO");
        campoCantidad5.dataset.valor = suma.toString();
      }
    }

    // Sumar conteo de billetes
    function sumarConteoBilletes() {
      let total = 0;

      const ids = ["b1", "b2", "b3", "b4", "b5", "b6"];

      ids.forEach(id => {
        const input = document.getElementById(id);
        if (input) {
          const valor = parseInt(input.value) || 0;
          total += valor;
        }
      });

      const celdaResultado = document.querySelector(".resultado-conteo-billetes");
      if (celdaResultado) {
        celdaResultado.textContent = total;
      }
    }

    // Configurar autocompletado para todos los inputs de loterÃ­a
    function configurarTodosLosAutocompletados() {
      console.log('Configurando autocompletados...');

      if (document.getElementById('loteria') && document.getElementById('sugerencias')) {
        setupAutoComplete('loteria', 'sugerencias');
        console.log('Configurado loteria');
      }

      for (let i = 1; i <= 30; i++) {
        const inputId = `loteria${i}`;
        const sugerenciasId = `sugerencias${i}`;

        if (document.getElementById(inputId) && document.getElementById(sugerenciasId)) {
          setupAutoComplete(inputId, sugerenciasId);
          console.log(`Configurado ${inputId}`);
        }
      }
    }

    // Confirmar borrado
    function confirmarBorrado() {
      Swal.fire({
        title: 'Â¿EstÃ¡s seguro?',
        text: "Se borrarÃ¡n todos los datos y no se podrÃ¡n recuperar.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'SÃ­, borrar todo',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          borrarTodo();
        }
      });
    }

    // Borrar todo
    // Borrar todo
    function borrarTodo() {
      // GUARDAR las claves importantes ANTES de borrar
      const peerIdPersistente = localStorage.getItem('peer-id-persistente');
      const peerRemoteId = localStorage.getItem('peer-remote-id');

      // Borrar todo el localStorage
      localStorage.clear();

      // RESTAURAR las claves importantes del sistema P2P
      if (peerIdPersistente) {
        localStorage.setItem('peer-id-persistente', peerIdPersistente);
      }
      if (peerRemoteId) {
        localStorage.setItem('peer-remote-id', peerRemoteId);
      }

      // Borrar todos los inputs y textareas
      document.querySelectorAll("input, textarea").forEach(el => {
        el.value = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      // Borrar todos los resultados y celdas
      document.querySelectorAll(".resultado, td[class^='r']").forEach(el => {
        el.textContent = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      // Borrar divs especiales
      document.querySelectorAll(".cantidad3, .cantidad5, .resultado-adicionales").forEach(el => {
        el.textContent = "";
        if (el.dataset.valor) el.dataset.valor = "0";
      });

      // Limpiar totales
      document.getElementById("total-general-bilteles").textContent = "";
      document.getElementById("total-general-monedas").textContent = "";
      document.getElementById("suma-total").textContent = "";
      document.getElementById("resul").textContent = "";
      document.getElementById("sobra").textContent = "";

      // Recalcular todo
      calcularTotales();
      verificarCamposVacios();
      sumarResultados();
      sumarInputsImpares();
      sumarConteoBilletes();

      // Si hay conexiÃ³n P2P activa, enviar los datos borrados al otro dispositivo
      if (conexion && conexion.open) {
        setTimeout(() => {
          enviarDatos();
        }, 300);
      }

      Swal.fire({
        icon: 'success',
        title: 'Â¡Borrado!',
        text: 'Todos los datos han sido borrados.',
        timer: 1500,
        showConfirmButton: false
      });
    }

    // Exportar a Excel
    function confirmarEnvioExcel() {
      Swal.fire({
        title: 'Â¿Exportar a Excel?',
        text: 'Se generarÃ¡ un archivo con los datos actuales.',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'SÃ­, exportar',
        cancelButtonText: 'Cancelar',
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33'
      }).then((result) => {
        if (result.isConfirmed) {
          exportarAExcelReal();
          Swal.fire({
            title: 'Â¡Exportado!',
            text: 'El archivo fue generado correctamente.',
            icon: 'success',
            timer: 2000,
            showConfirmButton: false
          });
        }
      });
    }

    // Exportar a Excel real
    function exportarAExcelReal() {
      const tabla = document.getElementById("miTabla");

      if (!tabla) {
        alert("No se encontrÃ³ la tabla.");
        return;
      }

      const tablaClon = tabla.cloneNode(true);

      const campos = tablaClon.querySelectorAll("input, textarea");
      campos.forEach(el => {
        const td = el.closest("td");
        if (td) {
          const span = document.createElement("span");
          span.textContent = el.value.trim();
          td.replaceChild(span, el);
        }
      });

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.table_to_sheet(tablaClon, { raw: true });

      XLSX.utils.book_append_sheet(wb, ws, "Datos");
      XLSX.writeFile(wb, "contador_pagatodo.xlsx");
    }

    // Mostrar fecha y hora actual
    function ponerFechaHora() {
      const ahora = new Date();

      const opciones = {
        weekday: "short",
        day: "2-digit",
        month: "short",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        hour12: true
      };

      const fechaHora = ahora.toLocaleString("es-CO", opciones);
      const elemento = document.getElementById("fechaHoraActual");
      if (elemento) {
        elemento.textContent = fechaHora;
      }
    }

    // ============================================
    // INICIALIZACIÃ“N AL CARGAR LA PÃGINA
    // ============================================

    document.addEventListener("DOMContentLoaded", () => {
      console.log('Inicializando aplicaciÃ³n...');

      // 1. Cargar datos desde localStorage
      const campos = document.querySelectorAll("textarea, input[type=tel], input[type=text], input.cantidad2, input.cantidad3, input.cantidad4, input.venta");
      const premiosDiv = document.querySelector(".cantidad3");
      const premiosGuardado = localStorage.getItem("premios-total");

      if (premiosDiv && premiosGuardado !== null) {
        premiosDiv.textContent = parseFloat(premiosGuardado).toLocaleString('es-CO');
        premiosDiv.dataset.valor = premiosGuardado;
      }

      campos.forEach((campo, index) => {
        const key = `input-${index}`;
        const valorGuardado = localStorage.getItem(key);
        if (valorGuardado !== null) {
          campo.value = valorGuardado;

          if (campo.classList.contains("cantidad2") || campo.classList.contains("cantidad3") || campo.classList.contains("cantidad4") || campo.classList.contains("venta")) {
            campo.dataset.valor = valorGuardado.replace(/\D/g, "") || "0";
          }
        }

        campo.addEventListener("input", () => {
          localStorage.setItem(key, campo.value);
          sumarInputsImpares();
          if (campo.classList.contains("cantidad2") || campo.classList.contains("cantidad3") || campo.classList.contains("cantidad4") || campo.classList.contains("venta")) {
            campo.dataset.valor = campo.value.replace(/\D/g, "") || "0";
          }

          calcularTotales?.();
          verificarCamposVacios?.();
          guardarCeldasTd();
        });
      });

      // Restaurar celdas <td class="rX">
      const celdas = document.querySelectorAll("td[class^='r']");
      celdas.forEach((celda, index) => {
        const valor = localStorage.getItem(`td-${index}`);
        if (valor !== null) {
          celda.textContent = valor;
        }
      });

      function guardarCeldasTd() {
        celdas.forEach((celda, index) => {
          localStorage.setItem(`td-${index}`, celda.textContent.trim());
        });
      }

      // 2. Inicializar PeerJS
      inicializarPeerJS();

      // 3. Configurar autocompletado
      configurarTodosLosAutocompletados();

      // 4. Configurar eventos de input para cÃ¡lculos
      document.addEventListener("input", (e) => {
        if (e.target.classList.contains('cantidad')) {
          calcularTotales();
          sumarConteoBilletes();
        }

        if (e.target.classList.contains('cantidad2') || e.target.classList.contains('cantidad4')) {
          calcularTotales();
        }

        if (e.target.classList.contains('input')) {
          calcularResultadoPorInput(e.target);
          sumarInputsImpares();
        }
      });

      // 5. Inicializar cÃ¡lculos
      setTimeout(() => {
        calcularTotales();
        verificarCamposVacios();
        sumarInputsImpares();
        sumarResultados();
        sumarConteoBilletes();
      }, 500);

      // 6. Iniciar reloj
      ponerFechaHora();
      setInterval(ponerFechaHora, 1000);
// APLICAR MODO LECTURA SI NO ES ANFITRIÃ“N
      setTimeout(() => {
        if (!esAnfitrion && conexion && conexion.open) {
          modoSoloLectura = true;
          esModoLecturaForzado = true;
          aplicarModoLectura();
        }
      }, 2000);
      console.log('AplicaciÃ³n inicializada correctamente');
    });

    // Configurar eventos para inputs de billetes
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll("#b1, #b2, #b3, #b4, #b5, #b6").forEach(input => {
        input.addEventListener("input", sumarConteoBilletes);
      });
    });
  </script>
</body>

</html>